"use strict";(self.webpackChunkreportEmbed=self.webpackChunkreportEmbed||[]).push([["drill-through"],{68323:function(gt,z,l){l.r(z),l.d(z,{DrillThroughModule:function(){return ft}});var p=l(26514),w=l(919),B=l(26069),R=l(82197),U=l(8334),H=l(98054),Z=l(99603),X=l(28926),Y=l(1745),T=l(24650),$=l(56319),K=l(57018),h=l(87941),A=l(44900),k=l(17926),O=l(13106),G=l(24356),Q=l(18630),q=l(56535),tt=l(74147),j=l(10236);function nt(r,t,e,i){return h.fF.assertValue(r,"matchedSection"),h.fF.assertAnyValue(t,"selectorColumnValuePairs"),h.fF.assertAnyValue(e,"visualContainerAppliedFilters"),h.fF.assertValue(i,"schema"),{targetSectionName:r.sectionName,targetReportGuid:r.reportObjectId?r.reportObjectId:void 0,sectionDisplayName:r.sectionDisplayName,reportDisplayName:r.reportDisplayName?r.reportDisplayName:void 0,getFilterContext:function(){return function(r,t,e,i){for(var n=[],a=[],u=0,o=r.matchedLinkFields;u<o.length;u++){var s=o[u],c=s.fieldExpr;if(!s.asAggregation&&!(0,q.kb)(c)){for(var f=c.getKeyColumns(i),v=[],d=[],m=function(C){var F=_.findIndex(t,function(L){return(0,tt.fS)(L.column,C)});h.fF.assert(function(){return-1!==F},"Expect every groupOn key of a matched section's column-type link field has a match in the selectors"),a.push(F),v.push(t[F].column),d.push(t[F].value)},x=0,D=f;x<D.length;x++)m(D[x]);var y=O.yl.fromSQExpr((0,G.Sh)(v,[d]));n.push({filterExpressionMetadata:{expressions:[c]},filter:y,isTransient:!1})}}if(1===r.allowedFiltersFromSource||2===r.allowedFiltersFromSource){if(!_.isEmpty(e)){var P=$.l.getFiltersToApplyFromVisualQueryFilterContext(e);2!==r.allowedFiltersFromSource&&_.remove(P,function(I){return 2===I.scope});for(var S=0,J=P;S<J.length;S++){var N=J[S];n.push({filter:N.filter,isTransient:!0,filterExpressionMetadata:N.filterExpressionMetadata,restatement:N.restatement,type:N.type,displayName:N.displayName})}}for(var E=new K.L(i),g=function(C){if(_.includes(a,C))return"continue";var F=t[C],L=O.yl.fromSQExpr((0,G.qu)(0,F.column,F.value)),W=O.yl.fromSQExpr((0,G.Sh)([F.column],[[F.value]]));if(!_.find(n,function(b){return O.yl.isSameFilter(b.filter,L)||O.yl.isSameFilter(b.filter,W)})){var pt=F.column.accept(E);n.push({filterExpressionMetadata:{expressions:[pt]},filter:W,isTransient:!0})}},V=0;V<t.length;V++)g(V)}return n}(r,t,e,i)},applyState:r.applyState}}var ot={provide:"drillthrough",useFactory:function(r,t,e,i,n,a,u){var o=new ut(r,t,e,i,n,u),s=[];if(s.push(o),a){var c=a.getNavigators();c&&s.push.apply(s,c||[])}return new Promise(function(f){f(new st(t,e,u,o,s))})},deps:[Z.J,w.i,U.D,B.z,R.J,H.W,X.vZ]},st=function(){function r(t,e,i,n,a){this.conceptualSchemaProxy=t,this.dataSources=e,this.featureSwitchService=i,this.defaultNavigator=n,this.drillthroughNavigators=a}return r.prototype.getMatchedSectionsInfo=function(t,e,i,n,a){return(0,p.mG)(this,void 0,A.J,function(){var u;return(0,p.Jh)(this,function(o){switch(o.label){case 0:return[4,this.getMatchedSections(t,void 0,e,i,n,a)];case 1:return u=o.sent(),[2,_.map(u,function(s){return _.extend(s.sectionInfo,{getFilterContext:s.action.getFilterContext})})]}})})},r.prototype.getForcedMatchSectionInfo=function(t,e,i,n,a,u){return(0,p.mG)(this,void 0,A.J,function(){var o,s,c;return(0,p.Jh)(this,function(f){switch(f.label){case 0:return[4,this.getMatchedSections(t,e,i,n,a,u)];case 1:return o=f.sent(),s=_.size(o),h.fF.assert(function(){return s<=1},"The target section name is given, at most 1 matching section might be found."),s<1?[2]:(c=o[0],[2,_.extend(c.sectionInfo,{getFilterContext:c.action.getFilterContext})])}})})},r.prototype.getDrillthroughActions=function(t,e,i,n){return(0,p.mG)(this,void 0,A.J,function(){var a;return(0,p.Jh)(this,function(u){switch(u.label){case 0:return[4,this.getMatchedSections(this.featureSwitchService.featureSwitches.onObject?2:0,void 0,t,e,i,n)];case 1:return a=u.sent(),[2,_.map(a,function(o){return o.action})]}})})},r.prototype.applyDrillthroughState=function(t,e){return void 0===e&&(e=!0),(0,p.mG)(this,void 0,A.J,function(){return(0,p.Jh)(this,function(i){return h.fF.assertValue(t,"action"),[2,t.applyState(t,e)]})})},r.prototype.getDrillthroughParameters=function(t){for(var e=[],i=0,n=this.drillthroughNavigators;i<n.length;i++){var u=n[i].getDrillthroughParameters(t);_.isEmpty(u)||e.push.apply(e,u||[])}return e},r.prototype.getMatchedSections=function(t,e,i,n,a,u){return(0,p.mG)(this,void 0,A.J,function(){var o,s,c,f,v,d,m,D;return(0,p.Jh)(this,function(M){switch(M.label){case 0:return 1!==_.size(a)?[2]:(o=function(r){h.fF.assertValue(r,"selectors");for(var t=[],e=0,i=r;e<i.length;e++){var n=i[e];if(n.dataMap)for(var a in n.dataMap)for(var u=0,o=n.dataMap[a];u<o.length;u++){var s=o[u];if(s){var f=s.expr;if(f){var v=(0,k.FD)(f);t.push(v)}}}}return t}(a),s=function(r){if(r){for(var t=[],e=function(o){o&&!_.isEmpty(o.args)&&1===o.values.length&&_.every(o.args,function(s,c){return t.push({column:s,value:o.values[0][c]})})},i=0,n=r;i<n.length;i++)e(n[i]);return t}}(o),0===_.size(s)&&0!==_.size(o)?[2]:(c=_.map(s,function(y){return y.column}),[4,this.conceptualSchemaProxy.get(this.dataSources.get())]));case 1:f=M.sent(),v=[],d=0,m=this.drillthroughNavigators,M.label=2;case 2:return d<m.length?[4,m[d].getMatchedSections(t,e,i,c,n,a,f)]:[3,5];case 3:D=M.sent(),_.isEmpty(D)||v.push.apply(v,D||[]),M.label=4;case 4:return d++,[3,2];case 5:return[2,_.map(v,function(y){return{sectionInfo:y,action:nt(y,s,u,f)}})]}})})},r.\u0275fac=function(e){j.\u0275\u0275invalidFactory()},r.\u0275prov=j.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(),ut=function(){function r(t,e,i,n,a,u){this.eventBridge=t,this.conceptualSchemaProxy=e,this.dataSources=i,this.explorationNavigationService=n,this.explorationStateManager=a,this.featureSwitchService=u}return r.prototype.getMatchedSections=function(t,e,i,n,a,u,o){return(0,p.mG)(this,void 0,A.J,function(){var s,c,v;return(0,p.Jh)(this,function(d){return h.fF.assertValue(t,"targetSectionType"),h.fF.assertAnyValue(e,"targetSectionName"),h.fF.assert(function(){return!_.isEmpty(i)},"sourceSectionName should not be empty."),h.fF.assertAnyValue(n,"selectorColumnExprs"),h.fF.assertValue(a,"visualContainer"),h.fF.assertAnyValue(u,"selectors"),h.fF.assertValue(o,"schema"),(s=this.featureSwitchService.featureSwitches.onObject)&&0===t?(h.fF.assertFail("We do NOT expect calling getMatchedSections with targetSectionType being SectionType.Regular when onObject FS is on"),[2,[]]):s||2!==t?(c=T.W.getMeasuresFromSelectors(u,a,o),v=this.getMatchedSectionInfoImpl(1===t?2:1,e,i,n,c,o),_.isEmpty(v)?[2]:[2,v]):(h.fF.assertFail("We do NOT expect calling getMatchedSections with targetSectionType being SectionType.Drillthrough when onObject FS is off"),[2,[]])})})},r.prototype.applyDrillthroughState=function(t,e){return(0,p.mG)(this,void 0,A.J,function(){var i,n,a,u,o;return(0,p.Jh)(this,function(s){switch(s.label){case 0:if(h.fF.assertValue(t,"action"),!(i=this.explorationNavigationService.getSectionByName(t.targetSectionName)))return[2];if(!(n=T.W.getApplyStateInfoForInternallDrillthrough(i,t.getFilterContext(),e)))return[2];a=this.explorationStateManager.createApplyBookmarkActivity("DrillThroughFilters"),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return u=s.sent(),this.explorationStateManager.apply(n.state,u,n.options,a),e&&this.eventBridge.publishToChannel(Y.t4l,{explorationContentChanged:!0}),a.resolve(),[3,4];case 3:return o=s.sent(),a.reject(o),[3,4];case 4:return[2]}})})},r.prototype.getDrillthroughParameters=function(t){if(_.isEmpty(t))return[];var e=this.explorationNavigationService.getCurrentExploration(),n=_.find(e.pods,function(a){return a.boundSection===t&&1===a.type});return n?n.parameters:[]},r.prototype.getMatchedSectionInfoImpl=function(t,e,i,n,a,u){var o=this;if(h.fF.assert(function(){return!_.isEmpty(i)},"fromSectionName should not be empty."),h.fF.assertAnyValue(n,"selectorColumnExprs"),h.fF.assertAnyValue(a,"selectorAggAndMeasureSQExprs"),h.fF.assertValue(u,"schema"),!_.isEmpty(n)||!_.isEmpty(a)){var s=this.explorationNavigationService.getCurrentExploration();h.fF.assertValue(s,"exploration");var f,c=s.pods;f=_.filter(c,function(E){return E.boundSection!==i&&(g=E,_.isEmpty(e)||g.boundSection===e)&&function(g){return g.type===t}(E);var g});for(var m=[],x=this.explorationNavigationService.getAllSections(),D=function(g){var V=_.find(x,function(C){return C.name===g.boundSection}),I=M.getMatchedInfoFromPod(g,V,n,a,u);I&&m.push(I)},M=this,y=0,P=f;y<P.length;y++)D(S=P[y]);if(!_.isEmpty(e)&&_.isEmpty(m)){var J=_.find(x,function(g){return g.name===e});if(!J||!this.isMatchingType(J.type,t))return;var S,N=1;(S=_.find(c,function(g){return g.boundSection===e}))&&1===S.config.acceptsFilterContext&&!(0,Q.i)(S.type,S.parameters)&&(N=0),m.push({sectionDisplayName:J.displayName,sectionName:J.name,matchedLinkFields:[],allowedFiltersFromSource:N,applyState:function(V,I){return o.applyDrillthroughState(V,I)}})}return m}},r.prototype.getMatchedInfoFromPod=function(t,e,i,n,a){var u=this,o=_.filter(t.parameters,function(f){return!f.isLegacySingleSelection});if(!_.isEmpty(o)){var s=T.W.getMatchedLinkFieldsFromParameters(o,i,n,a);if(!_.isEmpty(s)){var c=0===t.config.acceptsFilterContext||(0,Q.i)(t.type,t.parameters);return{sectionDisplayName:e.displayName,sectionName:e.name,matchedLinkFields:s,allowedFiltersFromSource:c?1:0,applyState:function(v,d){return u.applyDrillthroughState(v,d)}}}}},r.prototype.isMatchingType=function(t,e){return void 0===t||0===t?this.featureSwitchService.featureSwitches.onObject?0===e:1===e:2===t?1===e:1===t&&2===e},r}(),lt=l(93924),ct=l(1561),ht=l(91746),ft=function(){function r(){}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=j.\u0275\u0275defineNgModule({type:r}),r.\u0275inj=j.\u0275\u0275defineInjector({providers:[ot],imports:[lt.CommonModule,ct.O,ht.N]}),r}()}}]);